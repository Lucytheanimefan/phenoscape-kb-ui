<h2>Semantic Similarity</h2>
<p>Search for taxa with variation profiles similar to the phenotypic profile of the input gene.</p>
<div class="panel-body">
    <div class="row">
        <div class="col-md-4 col-sm-6 col-xs-12">
            <form role="form">
                <div>
                    <h4>Gene:</h4>
                    <div class="form-group" ng-class="{'has-success': geneToQuery, 'has-feedback': geneToQuery}">
                        <input type="text" ng-model="geneToQuery" placeholder="any gene symbol" typeahead="gene as (gene.label + ' (' + gene.taxon.label + ')') for gene in searchGenes($viewValue)" typeahead-loading="loadingGeneComplete" typeahead-wait-ms="300" typeahead-editable="false" class="form-control">
                        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true" ng-show="geneToQuery"></span>
                        <i ng-show="loadingGeneComplete" class="glyphicon glyphicon-refresh"></i>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row" ng-show="geneToQuery">
        <h4>Evolutionary profiles matching gene <b>{{geneToQuery.label}}</b> ({{geneToQuery.taxon.label}})</h4>
        <div class="col-sm-4">
            <table class="table table-condensed" cg-busy="topMatches.$promise">
                <thead>
                    <tr>
                        <th>Taxon</th>
                        <th popover="The Expect score is the number of matches one should expect to see at this level of similarity given the size of the database. The lower the Expect score, the more significant the match is." popover-trigger="mouseenter" popover-placement="bottom">Expect Score&nbsp;<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="match in topMatches.results" ng-click="selectMatch(match);" ng-class="{'info': (match === selectedMatch), 'active': hover}" ng-mouseenter="hover = true" ng-mouseleave="hover = false">
                        <td><a href="{{match.match_profile['@id']}}" target="_blank">{{match.match_profile.label}}</a></td>
                        <td class="text-center">{{match.expect_score | number : 2}}</td>
                        <td><span ng-show="hover || (match === selectedMatch)">âž </span></td>
                    </tr>
                </tbody>
            </table>
            <pagination total-items="matchesTotal.total" ng-model="matchesPage" max-size="maxSize" class="pagination-sm" boundary-links="true" rotate="false"  items-per-page="matchesLimit" cg-busy="matchesTotal.$promise" ng-change="pageChanged()"></pagination>
            <label>Download all matches:</label> <a class="btn btn-info btn-xs" target="_blank" href="http://pkb-new.nescent.org/kb/similarity/query?limit=0&amp;iri={{geneToQuery['@id'] | encodeURI}}" role="button">Text</a>
        </div>
        <div class="col-sm-8">
          <div ng-hide="selectedMatch" class="well"><h2 class="text-center"><i class="small">Click on any row to the left to view detailed results</i></h2>
          </div>
          <div class="panel panel-default" style="margin-top: 1em;" ng-show="selectedMatch">
            <div class="panel-heading"><h4 class="panel-title">Match details</h4></div>
            <div class="panel-body">
                <form class="form-horizontal kb-form-condensed">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Searched gene:</label>
                        <div class="col-sm-9">
                            <p class="form-control-static">{{geneToQuery.label}} ({{geneToQuery.taxon.label}}) <small><a href="#/gene/{{geneToQuery['@id'] | encodeURI}}">{{queryProfileSize.total}} phenotypes</a></small></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Matched taxon:</label>
                        <div class="col-sm-9">
                            <p class="form-control-static">{{selectedMatch.match_profile.label}} <small><a href="#/query_variation_profile?taxa={{[selectedMatch.match_profile['@id']] | json | encodeURI}}">{{selectedMatchProfileSize.total}} phenotypes</a></small></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Overall similarity:</label>
                        <div class="col-sm-9">
                            <p class="form-control-static">{{selectedMatch.median_score | number : 2}}</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Expect score:</label>
                        <div class="col-sm-9">
                            <p class="form-control-static">{{selectedMatch.expect_score | number : 2}}</p>
                        </div>
                    </div>
                </form>
            </div>
            <table class="table table-condensed table-striped" cg-busy="annotationMatches.$promise">
                <thead>
                    <tr>
                        <th>Gene Phenotype</th>
                        <th>Taxon Phenotype</th>
                        <th>Most Informative Common Subsumer</th>
                        <th>Match Information Content</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="match in annotationMatches.results">
                        <td>
                            <a title="{{match.query_annotation['@id']}}">{{match.query_annotation.label}}</a>
                        </td>
                        <td>
                            <a title="{{match.corpus_annotation['@id']}}">{{match.corpus_annotation.label}}</a>
                        </td>
                        <td>
                            <a title="{{match.best_subsumer.term['@id']}}">{{match.best_subsumer.term.label}}</a>
                        </td>
                        <td class="text-center">
                            <span>{{match.best_subsumer.ic | number : 2}}</span> <button ng-show="match.best_subsumer.disparity > 0.25" type="button" class="btn btn-warning btn-xs" popover="This match was found to be informative among taxa; however, it is relatively common among gene annotations." popover-trigger="mouseenter" popover-placement="left">IC warning</button>
                        </td>
                   </tr>
                </tbody>
            </table>
          </div>
      </div>
    </div>
</div>


